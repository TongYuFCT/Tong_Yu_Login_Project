<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Login to Application</title>
</head>

<body>
  <h1>Login to Application</h1>

  <table>
    <tr>
      <td style="font-weight: bold;">Login to the application:</td>
    </tr>
    <tr>
      <td>
        <form name="loginForm" id="loginForm">
          <div>
            Username: <input type="text" name="username" id="username" />
            Password: <input type="password" name="password" id="password" />
            <input type="button" onclick='loginUser()' value="Login" />
          </div>
        </form>
      </td>
    </tr>
  </table>
  <div id="loginInfo"></div>
  <div id="operations"></div>


  <script>
      function loginUser() {
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;
        
        if (username === "" || password === "") {
          alert("Both username and password are required");
          return false;
        } else {
          var loginData = {
            username: username,
            password: password
          };

          var request = new XMLHttpRequest();
          request.open("POST", "/rest/api/login", true); 
          request.setRequestHeader("Content-Type", "application/json"); 
          request.onreadystatechange = function() {
            if (this.readyState === XMLHttpRequest.DONE) {
              if (this.status === 200) {
                const responseData = JSON.parse(this.responseText);
                console.log('Login Successful:', this.responseText);
                // Handle login success here
                localStorage.setItem('username', responseData.username);
                localStorage.setItem('role', responseData.role);
                const loginInfoDiv = document.getElementById('loginInfo');
                    loginInfoDiv.innerHTML = `
                        <p>Username: ${responseData.username}</p>
                        <p>Role: ${responseData.role}</p>
                        <p>Token: ${responseData.token}</p>
                    `;
                    displayUserOperations(responseData.role);

                    const operationButton = document.createElement('button');
                    operationButton.textContent = 'Go to Operations';
                    operationButton.onclick = function() {
                        window.location.href = '/operation.html';
                    };
                    loginInfoDiv.appendChild(operationButton);
              } else {
                console.error('Login failed:', this.responseText);
                // Handle login failure here
              }
            }
          };
          request.send(JSON.stringify(loginData));
        } 
      }
      function displayUserOperations(role) {
        var operationsDiv = document.getElementById('operations');
        operationsDiv.innerHTML = ''; // 清空之前的内容
        var operationsHtml = '';

        // 根据角色展示不同的权限操作
        switch(role) {
          case 'SU':
            operationsHtml += '<p>SU可以执行的操作...</p>';
            break;
          case 'GA':
            operationsHtml += '<p>GA可以执行的操作...</p>';
            break;
          case 'GBO':
            operationsHtml += '<p>GBO可以执行的操作...</p>';
            break;
          case 'USER':
            operationsHtml += '<p>USER可以执行的操作...</p>';
            break;
          default:
            operationsHtml = '<p>未知角色</p>';
        }

        operationsDiv.innerHTML = operationsHtml; // 显示操作列表
      }
  </script>
</body>
</html>
